<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=11" />
  <meta name="generator" content="Doxygen 1.12.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NEML2: main</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="clipboard.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
window.MathJax = {
  loader: {load: ['[tex]/ams', '[tex]/physics', '[tex]/boldsymbol']},
  tex: {packages: {'[+]': ['ams', 'physics', 'boldsymbol']},
        tags: 'ams'}
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-tabs.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <!-- Demo animations -->
  <script type="text/javascript" src="anime.min.js"></script>
  <script type="text/javascript" src="work-dispatcher.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler.js"></script>
  <script type="text/javascript" src="simple-scheduler-demo.js"></script>
  <script type="text/javascript" src="static-hybrid-scheduler-demo.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init();
    DoxygenAwesomeParagraphLink.init();
    DoxygenAwesomeInteractiveToc.init();
    DoxygenAwesomeTabs.init();
    SimpleSchedulerDemo.init();
    StaticHybridSchedulerDemo.init();
  </script>
</head>
<body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr id="projectrow">
              <td id="projectalign">
                <div id="projectname">NEML2<span
                    id="projectnumber">&#160;2.0.0</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__2home_2runner_2work_2neml2_2neml2_2doc_2content_2tutorials_2models_2model__composition_2main.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">main</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1 empty">
    <ul>
      <li class="level2">
        <a href="#autotoc_md98">Problem description</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md99">Writing the input file</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md100">Evaluating the models: The hard way</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md101">Evaluating the models: The easy way</a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p>@insert-title:tutorials-models-model-composition</p>
<h2><a class="anchor" id="autotoc_md98"></a>
Problem description</h2>
<p>We have been working with the linear, isotropic elasticity model in the previous tutorials. We started with that example because it is arguably the simplest possible material model in the context of solid mechanics. It is simple not just because of the simplicity in the description of the material behavior, but also due to the fact that its mathematical formulation only involves one linear equation.</p>
<p>Much more complicated, nonlinear models can be created using NEML2.</p>
<p>Using a Perzyna-type viscoplasticity model as an example, it can be formulated as         </p><p class="formulaDsp">
\begin{align*}
  \boldsymbol{\varepsilon}^e &amp; = \boldsymbol{\varepsilon} - \boldsymbol{\varepsilon}^p, \\
  \boldsymbol{\sigma} &amp; = 3K\operatorname{vol}\boldsymbol{\varepsilon}^e + 2G\operatorname{dev}\boldsymbol{\varepsilon}^e, \\
  \bar{\sigma} &amp; = J_2(\boldsymbol{\sigma}), \\
  f^p &amp; = \bar{\sigma} - \sigma_y, \\
  \boldsymbol{N} &amp; = \pdv{f^p}{\boldsymbol{\sigma}}, \\
  \dot{\gamma} &amp; = \left( \dfrac{\left&lt; f^p \right&gt;}{\eta} \right)^n, \\
  \dot{\boldsymbol{\varepsilon}}^p &amp; = \dot{\gamma} \boldsymbol{N}.
\end{align*}
</p>
<p> The above formulation makes a series of <em>constitutive choices</em>:</p><ul>
<li>The strain is small and can be additively decomposed into elastic and plastic strains.</li>
<li>The elastic response is linear and isotropic.</li>
<li>The plastic flow is isochoric.</li>
<li>There is no isotropic hardening associated with plasticity.</li>
<li>There is no kinematic hardening associated with plasticity.</li>
<li>There is no back stress associated with plasticity.</li>
<li>The plastic flow is associative.</li>
<li>The plastic rate-sensitivity follows a power-law relation.</li>
</ul>
<p>Any change in one of the constitutive choices will result in a new material model. Suppose there are a total of \( N \) constitutive choices, each having \( k \) variants, the total number of possible material models would be \( k^N \).</p>
<p>In other words, the number of possible material models grows <em>exponentially</em> with the number of constitutive choices, and implementing all combinations is practically infeasible.</p>
<p>To address such challenge, NEML2 introduces a <em>model composition</em> mechanism which allows multiple models to be "stitched" together in a flexible, modular manner.</p>
<p>This tutorial demonstrates model composition using a much simplified model (without loss of generality). The model can be written as     </p><p class="formulaDsp">
\begin{align}
  \bar{a} &amp; = I_1(\boldsymbol{a}), \label{1} \\
  \bar{b} &amp; = J_2(\boldsymbol{b}), \label{2} \\
  \dot{b} &amp; = \bar{b} \boldsymbol{a} + \bar{a} \boldsymbol{b}, \label{3}
\end{align}
</p>
<p> where \( \boldsymbol{a} \) and \( \boldsymbol{b} \) are symmetric second order tensors.</p>
<h2><a class="anchor" id="autotoc_md99"></a>
Writing the input file</h2>
<p>Let us first search for available models describing this set of equations:</p><ul>
<li>\( \eqref{1} \&amp; \eqref{2} \) correspond to <a class="el" href="syntax-models.html#sr2invariant">SR2Invariant</a>;</li>
<li>\( \eqref{3} \) corresponds to <a class="el" href="syntax-models.html#sr2linearcombination">LinearCombination</a>.</li>
</ul>
<p>The input file then looks like @list-input:models/model_composition/input.i</p>
<h2><a class="anchor" id="autotoc_md100"></a>
Evaluating the models: The hard way</h2>
<p>Now that all three models are defined in the input file, we can load and evaluate them in sequence, with a bit of effort:</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> @list:cpp:models/model_composition/ex1.cxx</p>
<p class="startli">Output: @list-output:ex1</p>
</li>
<li><p class="startli"><b class="tab-title">Python</b> @list:python:models/model_composition/ex2.py</p>
<p class="startli">Output: @list-output:ex2</p>
</li>
</ul>
</div><div class="tabbed"></div><h2><a class="anchor" id="autotoc_md101"></a>
Evaluating the models: The easy way</h2>
<p>We were able to successfully calculate \( \dot{\boldsymbol{b}} \) by</p><ol type="1">
<li>calculating \( \bar{a} \) by evaluating \( \eqref{1} \),</li>
<li>calculating \( \bar{b} \) by evaluating \( \eqref{2} \),</li>
<li>setting the two coefficients of \( \eqref{3} \) to be \( \bar{b} \) and \( \bar{a} \) respectively,</li>
<li>calculating \( \dot{\boldsymbol{b}} \) by evaluating \( \eqref{3} \).</li>
</ol>
<p>However, that is not ideal because we had to</p><ul>
<li>Manually evaluate the equations and figure out the evaluation order, and</li>
<li>Manually set the parameters in \( \eqref{3} \) as outputs from \( \eqref{1}\&amp;\eqref{2} \).</li>
</ul>
<p>This manual method is not scalable when the number of equations, variables, and parameters increase.</p>
<p>Using NEML2's model composition capability can address these issues without sacrificing modularity. <a class="el" href="syntax-models.html#composedmodel">ComposedModel</a> allows us to compose a new model from the three existing models: @list-input:models/model_composition/input_composed.i</p>
<dl class="section note"><dt>Note</dt><dd>The names of the other two models are used to specify the coefficients of \( \eqref{3} \), i.e. &lsquo;coefficients = 'eq2 eq1&rsquo;`. This syntax is different from what was covered in the <a class="el" href="tutorials-models-model-parameters.html">previous tutorial</a> on model parameters and will be explained in more details in the <a class="el" href="tutorials-models-model-parameters-revisited.html">next tutorial</a>.</dd></dl>
<p>Let us first inspect the composed model and compare it against the three sub-models:</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> @list:cpp:models/model_composition/ex3.cxx</p>
<p class="startli">Output: @list-output:ex3</p>
</li>
<li><p class="startli"><b class="tab-title">Python</b> @list:python:models/model_composition/ex4.py</p>
<p class="startli">Output: @list-output:ex4</p>
</li>
</ul>
</div><div class="tabbed"></div><p>Note that the composed model "eq" automatically:</p><ul>
<li>Identified the input variables \( \boldsymbol{a} \) and \( \boldsymbol{b} \),</li>
<li>Identified the output variable \( \dot{\boldsymbol{b}} \),</li>
<li>Registered the parameters of \( \eqref{3} \) as input variables, and</li>
<li>Sorted out the evaluation order.</li>
</ul>
<p>The composed model can be evaluated in the same way as regular models:</p>
<div class="tabbed"></div><div class="tabbed"><ul>
<li><p class="startli"><b class="tab-title">C++</b> @list:cpp:models/model_composition/ex5.cxx</p>
<p class="startli">Output: @list-output:ex5</p>
</li>
<li><p class="startli"><b class="tab-title">Python</b> @list:python:models/model_composition/ex6.py</p>
<p class="startli">Output: @list-output:ex6</p>
</li>
</ul>
</div><div class="tabbed"></div><p>@insert-page-navigation </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
